<!DOCTYPE html>
<html>
<head>
    <title>Sales Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.css">
</head>
<body>
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1>Sales Resource Tracker</h1>
        <a href="/api/logout">Logout</a>
    </div>
    
    <section>
        <h3>Add New Resource</h3>
        <input id="title" placeholder="Title (e.g. Q3 Pitch Deck)">
        <input id="url" placeholder="Destination URL (YouTube/Drive)">
        <input id="slug" placeholder="Short-code (e.g. pitch-q3)">
        <button onclick="addLink()">Create Tracked Link</button>
    </section>

    <hr>

    <table>
        <thead>
            <tr>
                <th>Resource</th>
                <th>Clicks</th>
                <th>Feedback</th>
                <th>Tracking URL</th>
            </tr>
        </thead>
        <tbody id="stat-table"></tbody>
    </table>

    <script>
        async function loadStats() {
            const res = await fetch('/api/admin/stats');
            if (res.status === 401) window.location.href = '/login.html';
            
            const data = await res.json();
            const table = document.getElementById('stat-table');
            table.innerHTML = data.map(r => `
                <tr>
                    <td><b>${r.title}</b></td>
                    <td>${r.clicks}</td>
                    <td>${r.feedback_count} reviews</td>
                    <td><code>${window.location.origin}/go/${r.slug}</code></td>
                </tr>
            `).join('');
        }

        async function addLink() {
            const res = await fetch('/api/admin/resources', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    title: document.getElementById('title').value,
                    url: document.getElementById('url').value,
                    slug: document.getElementById('slug').value
                })
            });
            if (res.ok) {
                alert("Link added!");
                loadStats();
            }
        }
        loadStats();
    </script>
</body>
</html>